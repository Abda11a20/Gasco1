<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جميع المنتجات – Gasco</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <!-- Font Awesome CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --brand-primary: #f6d55c;
      --brand-secondary: #007BFF;
      --brand-orange-dark: #ff6f00;
      --brand-orange-hover: #e65100;
      --background-dark: #1C2526;
      --background-light: #2A3435;
      --text-dark: #0a0a0a;
      --text-light: #030303;
      /* ألوان جديدة للجدول */
      --table-header-bg: #3A4F50;
      --table-header-text: #ffffff;
      --table-row-bg: #1C2526; /* لون أسود داكن لخلفية الصفوف */
      --table-row-hover: #3A4F50;
      --table-border: #f6d55c;
      --table-bg: #e5f0f1; /* لون أسود داكن لخلفية الجدول */
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--background-dark);
      color: var(--text-light);
      margin: 0;
      direction: rtl;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* النَبَر */
    header {
      background-color: var(--background-light);
      padding: 20px 40px;
      border-bottom: 2px solid var(--brand-primary);
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .logo-img {
      max-width: 100px;
      height: auto;
    }

    .nav-links {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    #languageSwitcher {
      display: flex;
      gap: 10px;
    }

    .lang-btn {
      padding: 8px 16px;
      background-color: var(--background-light);
      border: 2px solid var(--brand-primary);
      color: var(--text-light);
      font-weight: bold;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s, transform 0.2s;
      font-size: 0.9rem;
    }

    .lang-btn:hover, .lang-btn.active {
      background-color: var(--brand-orange-dark);
      color: var(--text-light);
      transform: scale(1.05);
    }

    /* أيقونة العودة للـ Dashboard */
    .dashboard-icon {
      font-size: 1.8rem;
      color: var(--brand-primary);
      cursor: pointer;
      transition: color 0.3s;
    }

    .dashboard-icon:hover {
      color: var(--brand-orange-dark);
    }

    /* تصميم الكونتينر */
    .container {
      max-width: 1200px;
      margin: 3rem auto;
      padding: 2rem;
      background: linear-gradient(145deg, var(--background-light), var(--background-dark));
      border: 2px solid var(--brand-primary);
      border-radius: 15px;
      box-shadow: 0 0 .5rem rgba(0,0,0,0.3);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(246, 213, 92, 0.3);
    }

    /* العنوان */
    h2 {
      color: var(--brand-primary);
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      text-align: center;
      margin-bottom: 20px;
    }

    /* تصميم الجدول */
    .table {
      background: var(--table-bg); /* لون أسود داكن للجدول */
      border: 1px solid var(--table-border);
      border-radius: 10px;
      overflow: hidden;
    }

    .table thead {
      background: var(--table-header-bg);
    }

    .table th {
      color: var(--table-header-text);
      font-weight: bold;
    }

    .table tbody tr {
      background: var(--table-row-bg);
      transition: background 0.3s;
    }

    .table tbody tr:hover {
      background: var(--table-row-hover);
    }

    .table td {
      color: var(--text-light);
      vertical-align: middle;
    }

    /* تصميم الصورة */
    .table img {
      border-radius: 5px;
      border: 1px solid var(--brand-primary);
    }

    /* أزرار الجدول */
    .btn-warning, .btn-danger {
      font-weight: bold;
      border-radius: 10px;
      transition: transform 0.2s, background 0.3s;
      padding: 5px 10px; /* ضبط حجم الزر ليتناسب مع الأيقونة */
    }

    .btn-warning {
      background: linear-gradient(45deg, var(--brand-orange-dark), var(--brand-primary));
      border: none;
    }

    .btn-warning:hover {
      background: linear-gradient(45deg, var(--brand-orange-hover), var(--brand-primary));
      transform: scale(1.05);
    }

    .btn-danger {
      background: linear-gradient(45deg, #ff4444, #ff7777);
      border: none;
    }

    .btn-danger:hover {
      background: linear-gradient(45deg, #cc0000, #ff4444);
      transform: scale(1.05);
    }

    /* أيقونات التعديل والحذف */
    .btn-warning i, .btn-danger i {
      font-size: 1rem;
      color: var(--text-light);
    }

    /* تصميم النافذة المنبثقة */
    .modal-content {
      background: linear-gradient(145deg, var(--background-light), var(--background-dark));
      border: 2px solid var(--brand-primary);
      border-radius: 15px;
      color: var(--text-light);
    }

    .modal-header {
      border-bottom: 1px solid var(--brand-primary);
    }

    .modal-title {
      color: var(--brand-primary);
    }

    .modal-body .form-label {
      color: var(--text-light);
      font-weight: bold;
    }

    .modal-body .form-control {
      background-color: var(--background-light);
      color: var(--text-light);
      border: 1px solid var(--brand-primary);
      border-radius: 10px;
      transition: border-color 0.3s;
    }

    .modal-body .form-control:focus {
      background-color: var(--background-light);
      color: var(--text-light);
      border-color: var(--brand-orange-dark);
      box-shadow: 0 0 5px rgba(246, 213, 92, 0.5);
    }

    .modal-body .btn-primary {
      background: linear-gradient(45deg, var(--brand-orange-dark), var(--brand-primary));
      border: none;
      border-radius: 20px;
      font-weight: bold;
      transition: background 0.3s, transform 0.2s;
    }

    .modal-body .btn-primary:hover {
      background: linear-gradient(45deg, var(--brand-orange-hover), var(--brand-primary));
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <!-- النَبَر -->
  <header>
    <div class="nav-links d-flex align-items-center">
      <img src="image/logo.jpg" alt="Gasco Logo" class="logo-img me-3">
    </div>
    <div class="dashboard-icon" onclick="location.href='dashboard.html'">
      <i class="fas fa-tachometer-alt"></i>
    </div>
    <div id="languageSwitcher" class="d-flex align-items-center">
      <button onclick="setLanguage('ar')" class="lang-btn me-2" id="btnArabic">العربية</button>
      <button onclick="setLanguage('en')" class="lang-btn" id="btnEnglish">English</button>
    </div>
  </header>

  <!-- الجدول -->
  <div class="container">
    <h2 id="pageTitle">جميع المنتجات</h2>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th id="nameHeader">الاسم</th>
          <th id="categoryHeader">الفئة</th>
          <th id="priceHeader">السعر</th>
          <th id="stockHeader">المخزون</th>
          <th id="imageHeader">الصورة</th>
          <th id="actionsHeader">الإجراءات</th>
        </tr>
      </thead>
      <tbody id="productsBody">
        <!-- Dynamic rows -->
      </tbody>
    </table>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal" tabindex="-1" id="editModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">تعديل المنتج</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editForm">
            <div class="mb-3">
              <label for="productName" class="form-label" id="modalNameLabel">الاسم</label>
              <input type="text" class="form-control" id="productName" required />
            </div>
            <div class="mb-3">
              <label for="productCategory" class="form-label" id="modalCategoryLabel">الفئة</label>
              <input type="text" class="form-control" id="productCategory" required />
            </div>
            <div class="mb-3">
              <label for="productPrice" class="form-label" id="modalPriceLabel">السعر</label>
              <input type="number" class="form-control" id="productPrice" required />
            </div>
            <div class="mb-3">
              <label for="productStock" class="form-label" id="modalStockLabel">المخزون</label>
              <input type="number" class="form-control" id="productStock" required />
            </div>
            <button type="submit" class="btn btn-primary" id="saveButton">حفظ التغييرات</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ترجمات اللغة
    const translations = {
      ar: {
        title: "جميع المنتجات - Gasco",
        pageTitle: "جميع المنتجات",
        nameHeader: "الاسم",
        categoryHeader: "الفئة",
        priceHeader: "السعر",
        stockHeader: "المخزون",
        imageHeader: "الصورة",
        actionsHeader: "الإجراءات",
        modalTitle: "تعديل المنتج",
        modalNameLabel: "الاسم",
        modalCategoryLabel: "الفئة",
        modalPriceLabel: "السعر",
        modalStockLabel: "المخزون",
        saveButton: "حفظ التغييرات",
        deleteButton: "حذف",
        unauthorizedMessage: "غير مصرح",
        updateSuccessMessage: "تم تحديث المنتج بنجاح",
        updateErrorMessage: "خطأ أثناء تحديث المنتج: ",
        deleteConfirmMessage: "هل أنت متأكد من حذف هذا المنتج؟",
        deleteSuccessMessage: "تم حذف المنتج",
        deleteErrorMessage: "خطأ أثناء حذف المنتج: ",
        fetchErrorMessage: "خطأ في تحميل المنتجات: "
      },
      en: {
        title: "All Products - Gasco",
        pageTitle: "All Products",
        nameHeader: "Name",
        categoryHeader: "Category",
        priceHeader: "Price",
        stockHeader: "Stock",
        imageHeader: "Image",
        actionsHeader: "Actions",
        modalTitle: "Edit Product",
        modalNameLabel: "Name",
        modalCategoryLabel: "Category",
        modalPriceLabel: "Price",
        modalStockLabel: "Stock",
        saveButton: "Save Changes",
        deleteButton: "Delete",
        unauthorizedMessage: "Unauthorized",
        updateSuccessMessage: "Product updated successfully",
        updateErrorMessage: "Error updating product: ",
        deleteConfirmMessage: "Are you sure you want to delete this product?",
        deleteSuccessMessage: "Product deleted",
        deleteErrorMessage: "Error deleting product: ",
        fetchErrorMessage: "Error loading products: "
      }
    };

    function setLanguage(lang) {
      localStorage.setItem('lang', lang);
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

      document.title = translations[lang].title;

      const pageTitle = document.getElementById('pageTitle');
      if (pageTitle) pageTitle.textContent = translations[lang].pageTitle;

      const nameHeader = document.getElementById('nameHeader');
      if (nameHeader) nameHeader.textContent = translations[lang].nameHeader;

      const categoryHeader = document.getElementById('categoryHeader');
      if (categoryHeader) categoryHeader.textContent = translations[lang].categoryHeader;

      const priceHeader = document.getElementById('priceHeader');
      if (priceHeader) priceHeader.textContent = translations[lang].priceHeader;

      const stockHeader = document.getElementById('stockHeader');
      if (stockHeader) stockHeader.textContent = translations[lang].stockHeader;

      const imageHeader = document.getElementById('imageHeader');
      if (imageHeader) imageHeader.textContent = translations[lang].imageHeader;

      const actionsHeader = document.getElementById('actionsHeader');
      if (actionsHeader) actionsHeader.textContent = translations[lang].actionsHeader;

      const modalTitle = document.getElementById('modalTitle');
      if (modalTitle) modalTitle.textContent = translations[lang].modalTitle;

      const modalNameLabel = document.getElementById('modalNameLabel');
      if (modalNameLabel) modalNameLabel.textContent = translations[lang].modalNameLabel;

      const modalCategoryLabel = document.getElementById('modalCategoryLabel');
      if (modalCategoryLabel) modalCategoryLabel.textContent = translations[lang].modalCategoryLabel;

      const modalPriceLabel = document.getElementById('modalPriceLabel');
      if (modalPriceLabel) modalPriceLabel.textContent = translations[lang].modalPriceLabel;

      const modalStockLabel = document.getElementById('modalStockLabel');
      if (modalStockLabel) modalStockLabel.textContent = translations[lang].modalStockLabel;

      const saveButton = document.getElementById('saveButton');
      if (saveButton) saveButton.textContent = translations[lang].saveButton;

      const langButtons = document.querySelectorAll('.lang-btn');
      if (langButtons) {
        langButtons.forEach(btn => btn.classList.remove('active'));
        if (lang === 'ar') {
          document.getElementById('btnArabic')?.classList.add('active');
        } else {
          document.getElementById('btnEnglish')?.classList.add('active');
        }
      }
    }

    // تعريف الدالة openEditModal في النطاق العام
    let editModal; // لتخزين مثيل Modal خارج النطاق

    function openEditModal(id, name, category, price, stock) {
      // Populate the edit form with current product data
      document.getElementById('productName').value = name;
      document.getElementById('productCategory').value = category;
      document.getElementById('productPrice').value = price;
      document.getElementById('productStock').value = stock;

      // Show the modal
      editModal.show();

      // Handle form submission for editing
      const editForm = document.getElementById('editForm');
      const lang = localStorage.getItem('lang') || 'ar';
      const token = localStorage.getItem('token');
      const API_URL = 'https://gasco.vercel.app/product';

      editForm.onsubmit = function(e) {
        e.preventDefault();
        const updatedProduct = {
          name: document.getElementById('productName').value,
          category: document.getElementById('productCategory').value,
          price: document.getElementById('productPrice').value,
          stock: document.getElementById('productStock').value,
        };

        fetch(`${API_URL}/${id}`, {
          method: 'PUT',
          headers: {
            token: token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(updatedProduct)
        })
        .then(res => {
          if (!res.ok) {
            throw new Error(translations[lang].updateErrorMessage);
          }
          return res.json();
        })
        .then(() => {
          alert(translations[lang].updateSuccessMessage);
          location.reload(); // Reload page to refresh product list
        })
        .catch(err => alert(translations[lang].updateErrorMessage + err.message));
      };
    }

    // تعريف الدالة confirmDelete في النطاق العام
    window.confirmDelete = function(id) {
      const lang = localStorage.getItem('lang') || 'ar';
      const token = localStorage.getItem('token');
      const API_URL = 'https://gasco.vercel.app/product';

      if (confirm(translations[lang].deleteConfirmMessage)) {
        fetch(`${API_URL}/${id}`, {
          method: 'DELETE',
          headers: {
            token: token,
            'Content-Type': 'application/json'
          }
        })
        .then(res => {
          if (!res.ok) {
            throw new Error(translations[lang].deleteErrorMessage);
          }
          return res.json();
        })
        .then(() => {
          alert(translations[lang].deleteSuccessMessage);
          location.reload(); // Reload page to refresh product list
        })
        .catch(err => alert(translations[lang].deleteErrorMessage + err.message));
      }
    };

    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('token');
      const lang = localStorage.getItem('lang') || 'ar';
      setLanguage(lang);

      if (!token) {
        alert(translations[lang].unauthorizedMessage);
        window.location.href = 'login.html';
      }

      const API_URL = 'https://gasco.vercel.app/product';
      const tbody = document.getElementById('productsBody');
      editModal = new bootstrap.Modal(document.getElementById('editModal')); // تهيئة Modal

      fetch(API_URL, {
        headers: {
          token: token
        }
      })
      .then(res => {
        if (!res.ok) {
          throw new Error('Failed to fetch products: ' + res.statusText);
        }
        return res.json();
      })
      .then(data => {
        if (!data.success) {
          throw new Error(data.message || 'Failed to load products');
        }
        data.data.forEach(product => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${product.name}</td>
            <td>${product.category}</td>
            <td>${product.price} EGP</td>
            <td>${product.stock}</td>
            <td><img src="${product.image}" alt="" width="60" /></td>
            <td>
              <button class="btn btn-sm btn-warning me-2" onclick="openEditModal('${product._id}', '${product.name}', '${product.category}', ${product.price}, ${product.stock})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" onclick="confirmDelete('${product._id}')">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          tbody.appendChild(row);
        });
      })
      .catch(err => {
        console.error('Error loading products:', err);
        alert(translations[lang].fetchErrorMessage + err.message);
      });
    });
  </script>
</body>
</html>